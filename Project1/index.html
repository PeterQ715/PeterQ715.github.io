<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1 - Images of the Russian Empire</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 40px;
            font-size: 2.5em;
        }

        .section {
            background: white;
            margin: 40px 0;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            text-align: center;
            color: #3498db;
            margin-bottom: 30px;
            font-size: 2em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .single-image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .image-item {
            text-align: center;
        }

        .image-item img {
            max-width: 500px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .image-item img:hover {
            transform: scale(1.05);
        }

        .image-item h3 {
            margin-top: 15px;
            color: #34495e;
            font-size: 1.2em;
        }

        .gif-item img {
            max-width: 600px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .offset-info {
            text-align: center;
            color: #888;
            font-size: 0.9em;
            margin-top: 8px;
            line-height: 1.4;
        }

        .three-column-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .three-column-grid .image-item img {
            max-width: 350px;
        }

        .solution-text {
            margin-top: 30px;
            padding: 25px;
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            border-radius: 5px;
            font-size: 1.1em;
            color: #555;
            line-height: 1.8;
        }

        @media (max-width: 768px) {
            .image-container {
                flex-direction: column;
            }

            .three-column-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .image-item img {
                max-width: 100%;
            }

            .gif-item img {
                max-width: 100%;
            }

            .section {
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>CS180 Project 1: Images of the Russian Empire</h1>

        <!-- Part 1 Section -->
        <div class="section">
            <h2>Part 1: A single-scale implementation on low-res images</h2>
            <div class="solution-text">
                <strong>Solution:</strong><br>
                The single-scale implementation follows a straightforward approach to align
                the RGB channels of digitized Prokudin-Gorskii glass plate images. My algorithm first divides each
                input image into three equal parts representing the Blue, Green, and Red channels (ordered BGR from top
                to bottom). Using the Blue channel as the reference, it performs a brute-force search within a specified
                displacement window (typically [-20, 20] pixels) to find the optimal alignment for both Green and Red
                channels.<br><br>

                The core alignment process uses either L2 norm (Euclidean distance) or Normalized Cross-Correlation
                (NCC) as the similarity metric. For each potential displacement, the algorithm computes the overlap
                region between the reference and target images, applies border cropping (10% on each side) to avoid edge
                artifacts, and calculates the similarity score. The displacement that yields the best score is selected
                as the optimal offset.<br><br>

                This implementation successfully handles low-resolution images (like .jpg files) by testing all possible
                translations within the search window.
            </div>
            <div class="three-column-grid">
                <div class="image-item">
                    <img src="media/cathedral_color.png" alt="Cathedral">
                    <h3>Cathedral</h3>
                    <div class="offset-info">
                        Green Offset: (2, 5)<br>
                        Red Offset: (3, 12)<br>
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/monastery_color.png" alt="Monastery">
                    <h3>Monastery</h3>
                    <div class="offset-info">
                        Green Offset: (2, -3)<br>
                        Red Offset: (2, 3)<br>
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/tobolsk_color.png" alt="Tobolsk">
                    <h3>Tobolsk</h3>
                    <div class="offset-info">
                        Green Offset: (3, 3)<br>
                        Red Offset: (3, 6)<br>
                    </div>
                </div>
            </div>
        </div>

        <!-- Part 2 Section -->
        <div class="section">
            <h2>Part 2: A multiscale pyramid version that works on the large images</h2>
            <div class="solution-text">
                <strong>Solution:</strong><br>
                The multiscale pyramid implementation uses a coarse-to-fine approach to handle high-resolution images
                efficiently. The algorithm first builds image pyramids by recursively downsampling each level by a
                factor of 0.5 until the image becomes smaller than 16 pixels. Starting from the coarsest level, it
                performs alignment with a reduced search radius, then propagates and refines the results down through
                each pyramid level with local adjustments. This hierarchical approach significantly reduces
                computational complexity while maintaining alignment accuracy for large images.<br><br>

                To briefly summarize the pyramid construction and alignment process, the pyramid algorithm works
                similarly to the Horner's method. Just as we can transform a polynomial like f(x) = x³ + x² + x
                into x*(x*(x+1)) to reduce computation, the pyramid algorithm performs a continuous doubling process
                that essentially "peels off" the final offset layer by layer. If we assume the final offsets are dx and
                dy, they can always be represented in binary form. By decomposing this binary representation according
                to powers of 2, we reveal the essence of the pyramid algorithm - it's systematically finding each bit of
                the offset through a hierarchical search process, starting from the most significant bit at the coarsest
                level down to the least significant bit at the finest level.
            </div>
            <div class="three-column-grid">
                <div class="image-item">
                    <img src="media/L2/L2_church.jpg" alt="Church">
                    <h3>Church</h3>
                    <div class="offset-info">
                        Green Offset: (4, 25)<br>
                        Red Offset: (-4, 58)<br>
                        Time Cost: 5.031s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_emir.jpg" alt="Emir">
                    <h3>Emir</h3>
                    <div class="offset-info">
                        Green Offset: (24, 49)<br>
                        Red Offset: (54, 94)<br>
                        Time Cost: 5.461s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_harvesters.jpg" alt="Harvesters">
                    <h3>Harvesters</h3>
                    <div class="offset-info">
                        Green Offset: (16, 59)<br>
                        Red Offset: (12, 94)<br>
                        Time Cost: 5.541s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_icon.jpg" alt="Icon">
                    <h3>Icon</h3>
                    <div class="offset-info">
                        Green Offset: (17, 41)<br>
                        Red Offset: (23, 90)<br>
                        Time Cost: 5.254s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_italil.jpg" alt="Italil">
                    <h3>Italil</h3>
                    <div class="offset-info">
                        Green Offset: (21, 38)<br>
                        Red Offset: (35, 76)<br>
                        Time Cost: 5.385s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_lastochikino.jpg" alt="Lastochikino">
                    <h3>Lastochikino</h3>
                    <div class="offset-info">
                        Green Offset: (-2, -3)<br>
                        Red Offset: (-9, 75)<br>
                        Time Cost: 5.215s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_lugano.jpg" alt="Lugano">
                    <h3>Lugano</h3>
                    <div class="offset-info">
                        Green Offset: (-16, 41)<br>
                        Red Offset: (-29, 93)<br>
                        Time Cost: 5.451s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_melons.jpg" alt="Melons">
                    <h3>Melons</h3>
                    <div class="offset-info">
                        Green Offset: (11, 82)<br>
                        Red Offset: (16, 94)<br>
                        Time Cost: 5.033s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_self_portrait.jpg" alt="Self Portrait">
                    <h3>Self Portrait</h3>
                    <div class="offset-info">
                        Green Offset: (29, 79)<br>
                        Red Offset: (57, 94)<br>
                        Time Cost: 5.077s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_siren.jpg" alt="Siren">
                    <h3>Siren</h3>
                    <div class="offset-info">
                        Green Offset: (-6, 49)<br>
                        Red Offset: (-25, 94)<br>
                        Time Cost: 5.043s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/L2/L2_three_generations.jpg" alt="Three Generations">
                    <h3>Three Generations</h3>
                    <div class="offset-info">
                        Green Offset: (14, 53)<br>
                        Red Offset: (13, 94)<br>
                        Time Cost: 4.765s
                    </div>
                </div>
            </div>
            <div class="solution-text">
                <strong>Optimization:</strong><br>

                After analyzing the results, it is clear that the multiscale pyramid approach performs
                well on several images, including "Church", "Icon", "Italil", "Lastochikino",
                "Lugano" and "Siren".<br><br>

                However, there are some images where the alignment is not as accurate, such as "Emir",
                "Harvesters", "Melons", "Self Portrait", and "Three Generations". After my observation,
                these problematic images exhibit significant y-axis displacement in the red channel, which suggests
                that the pyramid search might get trapped in local optima due to the coarse-to-fine nature of the
                algorithm.<br><br>

                To address this issue, I optimized my algorithm by implementing a refined search strategy: after
                obtaining the initial dx and dy offsets from the pyramid search, I perform an additional brute-force
                enumeration within a smaller window specifically in the y-direction (typically [-100, 100] pixels).
                This
                secondary search step helps recover from potential misalignments in the vertical direction that may
                have
                been introduced during the pyramid downsampling and upsampling process, ultimately improving the
                final
                alignment quality for these challenging images.
            </div>

            <h3 style="text-align: center; color: #3498db; margin: 30px 0;">Before vs After Optimization</h3>

            <!-- Emir Comparison -->
            <div class="image-container">
                <div class="image-item">
                    <img src="media/L2/L2_emir.jpg" alt="Emir - Before Optimization">
                    <h3>Emir - Before</h3>
                    <div class="offset-info">
                        Green Offset: (24, 49)<br>
                        Red Offset: (54, 94)<br>
                        Time Cost: 5.461s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/Optimization/L2_emir.jpg" alt="Emir - After Optimization">
                    <h3>Emir - After</h3>
                    <div class="offset-info">
                        Green Offset: (24, 49)<br>
                        Red Offset: (54, 103)<br>
                        Time Cost: 29.567s
                    </div>
                </div>
            </div>

            <!-- Harvesters Comparison -->
            <div class="image-container">
                <div class="image-item">
                    <img src="media/L2/L2_harvesters.jpg" alt="Harvesters - Before Optimization">
                    <h3>Harvesters - Before</h3>
                    <div class="offset-info">
                        Green Offset: (16, 59)<br>
                        Red Offset: (12, 94)<br>
                        Time Cost: 5.541s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/Optimization/L2_harvesters.jpg" alt="Harvesters - After Optimization">
                    <h3>Harvesters - After</h3>
                    <div class="offset-info">
                        Green Offset: (16, 59)<br>
                        Red Offset: (12, 124)<br>
                        Time Cost: 30.908s
                    </div>
                </div>
            </div>

            <!-- Melons Comparison -->
            <div class="image-container">
                <div class="image-item">
                    <img src="media/L2/L2_melons.jpg" alt="Melons - Before Optimization">
                    <h3>Melons - Before</h3>
                    <div class="offset-info">
                        Green Offset: (11, 82)<br>
                        Red Offset: (16, 94)<br>
                        Time Cost: 5.033s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/Optimization/L2_melons.jpg" alt="Melons - After Optimization">
                    <h3>Melons - After</h3>
                    <div class="offset-info">
                        Green Offset: (11, 82)<br>
                        Red Offset: (16, 179)<br>
                        Time Cost: 39.382s
                    </div>
                </div>
            </div>

            <!-- Self Portrait Comparison -->
            <div class="image-container">
                <div class="image-item">
                    <img src="media/L2/L2_self_portrait.jpg" alt="Self Portrait - Before Optimization">
                    <h3>Self Portrait - Before</h3>
                    <div class="offset-info">
                        Green Offset: (29, 79)<br>
                        Red Offset: (57, 94)<br>
                        Time Cost: 5.077s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/Optimization/L2_self_portrait.jpg" alt="Self Portrait - After Optimization">
                    <h3>Self Portrait - After</h3>
                    <div class="offset-info">
                        Green Offset: (29, 79)<br>
                        Red Offset: (57, 177)<br>
                        Time Cost: 40.573s
                    </div>
                </div>
            </div>

            <!-- Three Generations Comparison -->
            <div class="image-container">
                <div class="image-item">
                    <img src="media/L2/L2_three_generations.jpg" alt="Three Generations - Before Optimization">
                    <h3>Three Generations - Before</h3>
                    <div class="offset-info">
                        Green Offset: (14, 53)<br>
                        Red Offset: (13, 94)<br>
                        Time Cost: 4.765s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/Optimization/L2_three_generations.jpg" alt="Three Generations - After Optimization">
                    <h3>Three Generations - After</h3>
                    <div class="offset-info">
                        Green Offset: (14, 53)<br>
                        Red Offset: (13, 112)<br>
                        Time Cost: 39.579s
                    </div>
                </div>
            </div>
        </div>

        <!-- Part 3 Section -->
        <div class="section">
            <h2>Part 3: More examples of my own choosing</h2>
            <div class="solution-text">
                <strong>Additional Examples:</strong><br>
                To further demonstrate the effectiveness of my multiscale pyramid algorithm, I selected two additional
                images from the Prokudin-Gorskii collection that present different alignment challenges. These examples
                showcase the algorithm's ability to handle diverse content and lighting conditions while maintaining
                consistent performance across various image types.
            </div>
            <div class="image-container">
                <div class="image-item">
                    <img src="media/Addtional/L2_kapri.jpg" alt="Kapri">
                    <h3>Kapri</h3>
                    <div class="offset-info">
                        Green Offset: (-13, 46)<br>
                        Red Offset: (-12, 103)<br>
                        Time Cost: 20.410s
                    </div>
                </div>
                <div class="image-item">
                    <img src="media/Addtional/L2_khan.jpg" alt="Khan">
                    <h3>Khan</h3>
                    <div class="offset-info">
                        Green Offset: (9, 39)<br>
                        Red Offset: (-7, 94)<br>
                        Time Cost: 23.554s
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>